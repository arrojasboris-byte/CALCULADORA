<!doctype html>
<html lang="es">
<meta charset="utf-8" />
<title>Admin</title>
<body>
  <h1>Admin</h1>
  <p>
    Características:<br>
    <textarea id="car" rows="5" cols="60"></textarea>
  </p>
  <p>
    Imágenes (una por línea):<br>
    <textarea id="imgs" rows="5" cols="60"></textarea>
  </p>
  <p>
    PIN: <input id="pin" placeholder="4321" />
    <button id="save">Guardar</button>
    <button id="load">Cargar</button>
    <span id="msg"></span>
  </p>

  <script>
    const GET = '/.netlify/functions/data-get';
    const SAVE = '/.netlify/functions/data-save';
    const $ = (id)=>document.getElementById(id);

    $('load').onclick = async ()=>{
      $('msg').textContent = 'Cargando...';
      const r = await fetch(GET, {cache:'no-store'});
      const d = await r.json();
      $('car').value = d.caracteristicasGama || '';
      $('imgs').value = (d.imagenes||[]).join('\n');
      $('msg').textContent = 'Listo ✓';
    };

    $('save').onclick = async ()=>{
      $('msg').textContent = 'Guardando...';
      const payload = {
        caracteristicasGama: $('car').value || '',
        imagenes: $('imgs').value.split('\n').map(s=>s.trim()).filter(Boolean).slice(0,20)
      };
      const r = await fetch(SAVE, {method:'POST', headers:{'content-type':'application/json'},
        body: JSON.stringify({ pin: $('pin').value.trim(), payload })});
      const d = await r.json().catch(()=>null);
      $('msg').textContent = (d && (d.updatedAt || d.imagenes)) ? 'Guardado ✓' : 'Error (¿PIN 4321?)';
    };

    // carga inicial
    $('load').click();
  </script>
</body>
</html>

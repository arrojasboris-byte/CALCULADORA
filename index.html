<!DOCTYPE html>
el('feedback').innerHTML = '';<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Catálogo Compartido</title>
<style>
:root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'; }
body { margin: 0; background: #f6f7f9; }
.container { max-width: 980px; margin: 0 auto; padding: 24px; }
.card { background: #fff; border-radius: 16px; padding: 20px; box-shadow: 0 6px 24px rgba(0,0,0,.06); }
.row { display: flex; gap: 16px; flex-wrap: wrap; }
.col { flex: 1 1 320px; }
h1 { margin: 0 0 8px; font-size: 28px; }
p.muted { color: #667085; margin: 6px 0 16px; }
textarea, input[type="text"] { width: 100%; box-sizing: border-box; padding: 12px; border-radius: 12px; border: 1px solid #d0d5dd; background: #fafafa; font-size: 14px; }
textarea { min-height: 160px; resize: vertical; }
.btn { appearance: none; border: 0; border-radius: 12px; padding: 10px 14px; cursor: pointer; font-weight: 600; }
.btn-primary { background: #0ea5e9; color: white; }
.btn-ghost { background: transparent; color: #0ea5e9; }
.btn:disabled { opacity: .6; cursor: not-allowed; }
.toolbar { display:flex; gap: 8px; align-items:center; justify-content:flex-end; margin: 12px 0 0; }
.grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; }
.imgbox { background: #f2f4f7; border: 1px dashed #d0d5dd; border-radius: 12px; min-height: 120px; display: grid; place-items: center; overflow: hidden; }
.imgbox img { width: 100%; height: 100%; object-fit: cover; }
.pill { display:inline-block; padding:4px 10px; border-radius: 999px; background:#eef2ff; color:#444; font-size:12px; }
.error { color: #b42318; margin-top: 6px; }
.success { color: #027a48; margin-top: 6px; }
details { background:#f8fafc; border:1px solid #e5e7eb; border-radius:12px; padding:12px; }
details summary { cursor:pointer; font-weight:600; }
.small { font-size: 12px; color: #667085; }
</style>
</head>
<body>
<div class="container">
<div class="card">
<h1>Catálogo Compartido</h1>
<p class="muted">Este enlace siempre muestra la versión más reciente. Para editar, pulsa <strong>Editar</strong> e introduce el PIN.</p>


<div class="row">
<div class="col">
<label><strong>Características de gama</strong></label>
<textarea id="caracteristicas" disabled placeholder="Describe aquí las características de la gama (materiales, opciones, conectividad, etc.)"></textarea>
</div>
<div class="col">
<label><strong>Imágenes (URLs)</strong></label>
<div id="imagenes-list"></div>
<button id="add-image" class="btn btn-ghost" disabled>+ Añadir imagen</button>
<p class="small">Pega direcciones (URLs) de imágenes públicas. Se mostrarán abajo.</p>
</div>
</div>


<div class="toolbar">
<span id="status" class="pill">Cargando…</span>
<button id="edit" class="btn">Editar</button>
<button id="save" class="btn btn-primary" disabled>Guardar</button>
<button id="cancel" class="btn" disabled>Cancelar</button>
</div>
</html>
}


function addImageInput() {
const list = el('imagenes-list');
const wrapper = document.createElement('div');
wrapper.style.margin = '6px 0';
const input = document.createElement('input');
input.type = 'text';
input.placeholder = 'https://…';
input.className = 'img-input';
input.disabled = false;
wrapper.appendChild(input);
list.appendChild(wrapper);
}


function gatherPayload() {
const caracteristicasGama = el('caracteristicas').value || '';
const urls = Array.from(document.querySelectorAll('.img-input'))
.map(i => (i.value || '').trim())
.filter(Boolean);
return { caracteristicasGama, imagenes: urls };
}


function save() {
if (!STATE.editing) return;
el('status').textContent = 'Guardando…';
const payload = gatherPayload();
google.script.run
.withSuccessHandler((next) => {
STATE.editing = false;
STATE.pin = null;
setDisabled(true);
render(next);
el('feedback').innerHTML = '<p class="success">Cambios guardados.</p>';
el('status').textContent = 'Guardado';
})
.withFailureHandler(err => {
el('feedback').innerHTML = `<p class="error">${(err && err.message) || 'Error al guardar'}.</p>`;
el('status').textContent = 'Error';
})
.saveData(STATE.pin, payload);
}


// Eventos
document.addEventListener('DOMContentLoaded', () => {
setDisabled(true);
google.script.run.withSuccessHandler(render).getData();
el('edit').addEventListener('click', startEdit);
el('cancel').addEventListener('click', cancelEdit);
el('save').addEventListener('click', save);
el('add-image').addEventListener('click', addImageInput);
});
</script>
</body>
</html>
